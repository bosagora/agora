<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8"/>
		<title>Function isInvalidReason</title>
		<link rel="stylesheet" type="text/css" href="../../../../styles/ddox.css"/>
		<link rel="stylesheet" href="../../../../prettify/prettify.css" type="text/css"/>
		<script type="text/javascript" src="../../../../scripts/jquery.js">/**/</script><script type="text/javascript" src="../../../../scripts/ddox.js">/**/</script>
	</head>
	<body onload="setupDdox();">
		<nav id="main-nav">
			<noscript>
				<p style="color: red">The search functionality needs JavaScript enabled</p>
			</noscript>
			<div id="symbolSearchPane" style="display: none">
				<form action="#" method="GET">
					<input id="symbolSearch" type="text" name="q" placeholder="Search for symbols" autocomplete="off" onchange="performSymbolSearch(40);" onkeypress="this.onchange();" onpaste="this.onchange();" oninput="this.onchange();"/>
				</form>
				<ul id="symbolSearchResults" class="symbolList" style="display: none"></ul><script type="application/javascript" src="../../../../symbols.js"></script><script type="application/javascript">var symbolSearchRootDir = "../../../../";
$('#symbolSearchPane').show();</script>
			</div>
			<ul class="tree-view">
				<li class="tree-view ">
					<div class="package ">agora
					</div>
			<ul class="tree-view">
				<li class="tree-view collapsed">
					<div class="package ">api
					</div>
			<ul class="tree-view">
				<li>
					<div class="module ">
						<a href="../../../../agora/api/Admin.html">Admin</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/api/FullNode.html">FullNode</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/api/Handlers.html">Handlers</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/api/Registry.html">Registry</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/api/Validator.html">Validator</a>
					</div>
				</li>
			</ul>
				</li>
				<li class="tree-view collapsed">
					<div class="package ">common
					</div>
			<ul class="tree-view">
				<li>
					<div class="module ">
						<a href="../../../../agora/common/Amount.html">Amount</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/common/BanManager.html">BanManager</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/common/BitMask.html">BitMask</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/common/DNS.html">DNS</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/common/Ensure.html">Ensure</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/common/FileBasedLock.html">FileBasedLock</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/common/ManagedDatabase.html">ManagedDatabase</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/common/Set.html">Set</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/common/Task.html">Task</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/common/Types.html">Types</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/common/VibeTask.html">VibeTask</a>
					</div>
				</li>
			</ul>
				</li>
				<li class="tree-view ">
					<div class="package ">consensus
					</div>
			<ul class="tree-view">
				<li class="tree-view collapsed">
					<div class="package ">data
					</div>
			<ul class="tree-view">
				<li class="tree-view collapsed">
					<div class="package ">
						<a href="../../../../agora/consensus/data/genesis.html">genesis</a>
					</div>
			<ul class="tree-view">
				<li>
					<div class="module ">
						<a href="../../../../agora/consensus/data/genesis/Coinnet.html">Coinnet</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/consensus/data/genesis/Test.html">Test</a>
					</div>
				</li>
			</ul>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/consensus/data/Block.html">Block</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/consensus/data/Enrollment.html">Enrollment</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/consensus/data/Params.html">Params</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/consensus/data/PreImageInfo.html">PreImageInfo</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/consensus/data/Transaction.html">Transaction</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/consensus/data/UTXO.html">UTXO</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/consensus/data/ValidatorBlockSig.html">ValidatorBlockSig</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/consensus/data/ValidatorInfo.html">ValidatorInfo</a>
					</div>
				</li>
			</ul>
				</li>
				<li class="tree-view collapsed">
					<div class="package ">pool
					</div>
			<ul class="tree-view">
				<li>
					<div class="module ">
						<a href="../../../../agora/consensus/pool/Enrollment.html">Enrollment</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/consensus/pool/Transaction.html">Transaction</a>
					</div>
				</li>
			</ul>
				</li>
				<li class="tree-view collapsed">
					<div class="package ">protocol
					</div>
			<ul class="tree-view">
				<li>
					<div class="module ">
						<a href="../../../../agora/consensus/protocol/Config.html">Config</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/consensus/protocol/Data.html">Data</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/consensus/protocol/EnvelopeStore.html">EnvelopeStore</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/consensus/protocol/Nominator.html">Nominator</a>
					</div>
				</li>
			</ul>
				</li>
				<li class="tree-view collapsed">
					<div class="package ">state
					</div>
			<ul class="tree-view">
				<li>
					<div class="module ">
						<a href="../../../../agora/consensus/state/Ledger.html">Ledger</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/consensus/state/UTXOCache.html">UTXOCache</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/consensus/state/UTXODB.html">UTXODB</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/consensus/state/UTXOSet.html">UTXOSet</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/consensus/state/ValidatorSet.html">ValidatorSet</a>
					</div>
				</li>
			</ul>
				</li>
				<li class="tree-view ">
					<div class="package ">
						<a href="../../../../agora/consensus/validation.html">validation</a>
					</div>
			<ul class="tree-view">
				<li>
					<div class="module ">
						<a href="../../../../agora/consensus/validation/Block.html">Block</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/consensus/validation/Enrollment.html">Enrollment</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/consensus/validation/PreImage.html">PreImage</a>
					</div>
				</li>
				<li>
					<div class="module selected">
						<a href="../../../../agora/consensus/validation/Transaction.html">Transaction</a>
					</div>
				</li>
			</ul>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/consensus/BlockStorage.html">BlockStorage</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/consensus/EnrollmentManager.html">EnrollmentManager</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/consensus/Fee.html">Fee</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/consensus/Ledger.html">Ledger</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/consensus/PreImage.html">PreImage</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/consensus/Quorum.html">Quorum</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/consensus/Reward.html">Reward</a>
					</div>
				</li>
			</ul>
				</li>
				<li class="tree-view collapsed">
					<div class="package ">crypto
					</div>
			<ul class="tree-view">
				<li>
					<div class="module ">
						<a href="../../../../agora/crypto/Bech32.html">Bech32</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/crypto/Crc16.html">Crc16</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/crypto/Key.html">Key</a>
					</div>
				</li>
			</ul>
				</li>
				<li class="tree-view collapsed">
					<div class="package ">flash
					</div>
			<ul class="tree-view">
				<li class="tree-view collapsed">
					<div class="package ">api
					</div>
			<ul class="tree-view">
				<li>
					<div class="module ">
						<a href="../../../../agora/flash/api/FlashAPI.html">FlashAPI</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/flash/api/FlashControlAPI.html">FlashControlAPI</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/flash/api/FlashListenerAPI.html">FlashListenerAPI</a>
					</div>
				</li>
			</ul>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/flash/Channel.html">Channel</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/flash/Config.html">Config</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/flash/ErrorCode.html">ErrorCode</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/flash/Invoice.html">Invoice</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/flash/Network.html">Network</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/flash/Node.html">Node</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/flash/OnionPacket.html">OnionPacket</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/flash/Route.html">Route</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/flash/Scripts.html">Scripts</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/flash/Types.html">Types</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/flash/UpdateSigner.html">UpdateSigner</a>
					</div>
				</li>
			</ul>
				</li>
				<li class="tree-view collapsed">
					<div class="package ">network
					</div>
			<ul class="tree-view">
				<li>
					<div class="module ">
						<a href="../../../../agora/network/Client.html">Client</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/network/Clock.html">Clock</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/network/DNSResolver.html">DNSResolver</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/network/Manager.html">Manager</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/network/RPC.html">RPC</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/network/VibeManager.html">VibeManager</a>
					</div>
				</li>
			</ul>
				</li>
				<li class="tree-view collapsed">
					<div class="package ">node
					</div>
			<ul class="tree-view">
				<li class="tree-view collapsed">
					<div class="package ">admin
					</div>
			<ul class="tree-view">
				<li>
					<div class="module ">
						<a href="../../../../agora/node/admin/AdminInterface.html">AdminInterface</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/node/admin/Setup.html">Setup</a>
					</div>
				</li>
			</ul>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/node/Config.html">Config</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/node/FullNode.html">FullNode</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/node/main.html">main</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/node/Registry.html">Registry</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/node/Runner.html">Runner</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/node/TransactionRelayer.html">TransactionRelayer</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/node/Validator.html">Validator</a>
					</div>
				</li>
			</ul>
				</li>
				<li class="tree-view collapsed">
					<div class="package ">script
					</div>
			<ul class="tree-view">
				<li>
					<div class="module ">
						<a href="../../../../agora/script/Engine.html">Engine</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/script/Lock.html">Lock</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/script/Opcodes.html">Opcodes</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/script/ScopeCondition.html">ScopeCondition</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/script/Script.html">Script</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/script/Signature.html">Signature</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/script/Stack.html">Stack</a>
					</div>
				</li>
			</ul>
				</li>
				<li class="tree-view collapsed">
					<div class="package ">stats
					</div>
			<ul class="tree-view">
				<li>
					<div class="module ">
						<a href="../../../../agora/stats/App.html">App</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/stats/Block.html">Block</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/stats/Collector.html">Collector</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/stats/CollectorRegistry.html">CollectorRegistry</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/stats/EndpointReq.html">EndpointReq</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/stats/Registry.html">Registry</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/stats/Slot.html">Slot</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/stats/StatFormatter.html">StatFormatter</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/stats/Stats.html">Stats</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/stats/Tx.html">Tx</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/stats/Utils.html">Utils</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/stats/Validator.html">Validator</a>
					</div>
				</li>
			</ul>
				</li>
				<li class="tree-view collapsed">
					<div class="package ">test
					</div>
			<ul class="tree-view">
				<li>
					<div class="module ">
						<a href="../../../../agora/test/API.html">API</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/BanManager.html">BanManager</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/Base.html">Base</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/BlockRewards.html">BlockRewards</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/BlockTimeConsensus.html">BlockTimeConsensus</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/Byzantine.html">Byzantine</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/Crypto.html">Crypto</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/DNS.html">DNS</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/EmptyBlocks.html">EmptyBlocks</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/EnrollDifferentUTXOs.html">EnrollDifferentUTXOs</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/EnrollmentManager.html">EnrollmentManager</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/Fee.html">Fee</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/Flash.html">Flash</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/FutureEnrollment.html">FutureEnrollment</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/GenesisBlock.html">GenesisBlock</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/GossipProtocol.html">GossipProtocol</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/InvalidBlockSigByzantine.html">InvalidBlockSigByzantine</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/Ledger.html">Ledger</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/LocalTransactions.html">LocalTransactions</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/LockHeight.html">LockHeight</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/ManyBlocks.html">ManyBlocks</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/ManyValidators.html">ManyValidators</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/MissingPreImageDetection.html">MissingPreImageDetection</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/MultiRoundConsensus.html">MultiRoundConsensus</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/NameRegistry.html">NameRegistry</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/NetworkClient.html">NetworkClient</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/NetworkDiscovery.html">NetworkDiscovery</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/NetworkManager.html">NetworkManager</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/NominatingCatchup.html">NominatingCatchup</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/PeriodicCatchup.html">PeriodicCatchup</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/PostTransactionResult.html">PostTransactionResult</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/PreImageNoFlood.html">PreImageNoFlood</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/PreimageSharing.html">PreimageSharing</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/Quorum.html">Quorum</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/QuorumPreimage.html">QuorumPreimage</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/QuorumShuffle.html">QuorumShuffle</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/Restart.html">Restart</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/RestoreSCPState.html">RestoreSCPState</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/RestoreSlashingInfo.html">RestoreSlashingInfo</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/Script.html">Script</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/Simple.html">Simple</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/SlashingMisbehavingValidator.html">SlashingMisbehavingValidator</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/TimeBlockInterval.html">TimeBlockInterval</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/TimeDrift.html">TimeDrift</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/Timeout.html">Timeout</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/TransactionReplacement.html">TransactionReplacement</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/UnlockAge.html">UnlockAge</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/ValidatorCleanRestart.html">ValidatorCleanRestart</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/ValidatorCount.html">ValidatorCount</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/ValidatorRecurringEnrollment.html">ValidatorRecurringEnrollment</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/test/VariableBlockSize.html">VariableBlockSize</a>
					</div>
				</li>
			</ul>
				</li>
				<li class="tree-view collapsed">
					<div class="package ">utils
					</div>
			<ul class="tree-view">
				<li>
					<div class="module ">
						<a href="../../../../agora/utils/Backoff.html">Backoff</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/utils/InetUtils.html">InetUtils</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/utils/Log.html">Log</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/utils/PrettyPrinter.html">PrettyPrinter</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/utils/SCPPrettyPrinter.html">SCPPrettyPrinter</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/utils/Test.html">Test</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/utils/TxBuilder.html">TxBuilder</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/utils/Utility.html">Utility</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/utils/WellKnownKeys.html">WellKnownKeys</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../agora/utils/Workarounds.html">Workarounds</a>
					</div>
				</li>
			</ul>
				</li>
			</ul>
				</li>
				<li class="tree-view collapsed">
					<div class="package ">mmdb
					</div>
			<ul class="tree-view">
				<li>
					<div class="module ">
						<a href="../../../../mmdb/MaxMindDB.html">MaxMindDB</a>
					</div>
				</li>
			</ul>
				</li>
				<li class="tree-view collapsed">
					<div class="package ">scpd
					</div>
			<ul class="tree-view">
				<li class="tree-view collapsed">
					<div class="package ">quorum
					</div>
			<ul class="tree-view">
				<li>
					<div class="module ">
						<a href="../../../../scpd/quorum/QuorumIntersectionChecker.html">QuorumIntersectionChecker</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../scpd/quorum/QuorumTracker.html">QuorumTracker</a>
					</div>
				</li>
			</ul>
				</li>
				<li class="tree-view collapsed">
					<div class="package ">scp
					</div>
			<ul class="tree-view">
				<li>
					<div class="module ">
						<a href="../../../../scpd/scp/BallotProtocol.html">BallotProtocol</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../scpd/scp/LocalNode.html">LocalNode</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../scpd/scp/NominationProtocol.html">NominationProtocol</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../scpd/scp/QuorumSetUtils.html">QuorumSetUtils</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../scpd/scp/SCP.html">SCP</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../scpd/scp/SCPDriver.html">SCPDriver</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../scpd/scp/Slot.html">Slot</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../scpd/scp/Utils.html">Utils</a>
					</div>
				</li>
			</ul>
				</li>
				<li class="tree-view collapsed">
					<div class="package ">tests
					</div>
			<ul class="tree-view">
				<li>
					<div class="module ">
						<a href="../../../../scpd/tests/GlueTypes.html">GlueTypes</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../scpd/tests/LayoutTest.html">LayoutTest</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../scpd/tests/SizeTest.html">SizeTest</a>
					</div>
				</li>
			</ul>
				</li>
				<li class="tree-view collapsed">
					<div class="package ">types
					</div>
			<ul class="tree-view">
				<li>
					<div class="module ">
						<a href="../../../../scpd/types/Stellar_SCP.html">Stellar_SCP</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../scpd/types/Stellar_types.html">Stellar_types</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../scpd/types/Utils.html">Utils</a>
					</div>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../scpd/types/XDRBase.html">XDRBase</a>
					</div>
				</li>
			</ul>
				</li>
				<li>
					<div class="module ">
						<a href="../../../../scpd/Cpp.html">Cpp</a>
					</div>
				</li>
			</ul>
				</li>
			</ul>
		</nav>
		<div id="main-contents">
			<h1>Function isInvalidReason</h1><p>Get result of transaction data and signature verification
</p>
			<div class="prototype">
				<code class="lang-d">
					<div class="single-prototype">
			<span class="typ">string</span> <span class="pln">isInvalidReason</span>
			<span class="pun">(</span>
			<br/>
			&nbsp;&nbsp;<span class="kwd">in ref </span><span class="kwd">const</span><span class="pun">(</span><a href="../../../../agora/consensus/data/Transaction/transaction.html"><span class="typ">Transaction</span></a><span class="pun">)</span> <span class="pln">tx</span><span class="pun">,</span>
			<br/>
			&nbsp;&nbsp;<a href="../../../../agora/script/Engine/engine.html"><span class="typ">Engine</span></a> <span class="pln">engine</span><span class="pun">,</span>
			<br/>
			&nbsp;&nbsp;<span class="kwd">scope </span><span class="kwd">nothrow</span> <span class="kwd">@safe</span> <span class="typ">bool</span> <span class="kwd">delegate</span><span class="pun">(</span><span class="kwd">in</span> <span class="kwd">ref</span> <span class="pln">geod24<wbr/></span><span class="pun">.</span><span class="pln">bitblob<wbr/></span><span class="pun">.</span><span class="typ">BitBlob</span>!(64L)<span class="pun">, </span><span class="kwd">out</span> <a href="../../../../agora/consensus/data/UTXO/utxo.html"><span class="pln">UTXO</span></a><span class="pun">)</span> <span class="pln">findUTXO</span><span class="pun">,</span>
			<br/>
			&nbsp;&nbsp;<span class="kwd">in </span><span class="kwd">const</span><span class="pun">(</span><a href="../../../../agora/common/Types/height.html"><span class="typ">Height</span></a><span class="pun">)</span> <span class="pln">height</span><span class="pun">,</span>
			<br/>
			&nbsp;&nbsp;<span class="kwd">scope </span><span class="kwd">nothrow</span> <span class="kwd">@safe</span> <span class="typ">string</span> <span class="kwd">delegate</span><span class="pun">(</span><span class="kwd">in</span> <span class="kwd">ref</span> <a href="../../../../agora/consensus/data/Transaction/transaction.html"><span class="typ">Transaction</span></a><span class="pun">, </span><a href="../../../../agora/common/Amount/amount.html"><span class="typ">Amount</span></a><span class="pun">)</span> <span class="pln">checkFee</span><span class="pun">,</span>
			<br/>
			&nbsp;&nbsp;<span class="kwd">scope </span><span class="kwd">nothrow</span> <span class="kwd">@safe</span> <a href="../../../../agora/common/Amount/amount.html"><span class="typ">Amount</span></a> <span class="kwd">delegate</span><span class="pun">(</span><span class="pln">geod24<wbr/></span><span class="pun">.</span><span class="pln">bitblob<wbr/></span><span class="pun">.</span><span class="typ">BitBlob</span>!(64L)<span class="pun">)</span> <span class="pln">getPenaltyDeposit</span>
			<br/>
			<span class="pun">)</span><span class="pln"> </span><span class="kwd">nothrow @safe</span><span class="pun">;</span>
					</div>
				</code>
			</div>
			<section></section>

			<section><h2>Parameters</h2>
<table><col class="caption"><tr><th>Name</th><th>Description</th></tr>
<tr><td id="tx">tx</td><td> <code class="lang-d"><span class="typ">Transaction</span></code></td></tr>
<tr><td id="engine">engine</td><td> script execution engine</td></tr>
<tr><td id="findUTXO">findUTXO</td><td> delegate for finding <code class="lang-d"><span class="typ">Output</span></code></td></tr>
<tr><td id="height">height</td><td> height of block</td></tr>
<tr><td id="checkFee">checkFee</td><td> delegate for checking tx fee</td></tr>
</table>
</section>
<section><h2>Return</h2>
<p><code class="lang-d"><span class="kwd">null</span></code> if the transaction is valid, a string explaining the reason it
        is invalid otherwise.
</p>
</section>
<section><h2>Example</h2>
<p>verify transaction data
</p>
<pre class="code"><code class="lang-d"><span class="kwd">scope <a href="../../../../agora/consensus/validation/Transaction/is_invalid_reason.html#engine"></span><span class="pln">engine</span></a><span class="pln"> </span><span class="pun">= </span><span class="kwd">new </span><span class="typ">Engine</span><span class="pun">();
</span><span class="kwd">scope </span><span class="pln">storage </span><span class="pun">= </span><span class="kwd">new </span><span class="typ">MemoryUTXOSet</span><span class="pun">;
</span><span class="typ">KeyPair</span><span class="pun">[] </span><span class="pln">key_pairs </span><span class="pun">= [</span><span class="typ">KeyPair<wbr/></span><span class="pun">.</span><span class="pln">random</span><span class="pun">, </span><span class="typ">KeyPair<wbr/></span><span class="pun">.</span><span class="pln">random</span><span class="pun">, </span><span class="typ">KeyPair<wbr/></span><span class="pun">.</span><span class="pln">random</span><span class="pun">, </span><span class="typ">KeyPair<wbr/></span><span class="pun">.</span><span class="pln">random</span><span class="pun">];

</span><span class="kwd">scope </span><span class="pln">payload_checker </span><span class="pun">= </span><span class="kwd">new </span><span class="typ">FeeManager</span><span class="pun">();
</span><span class="kwd">scope </span><span class="pln">checker </span><span class="pun">= &amp;</span><span class="pln">payload_checker<wbr/></span><span class="pun">.</span><span class="pln">check</span><span class="pun">;

</span><span class="com">// Creates the first transaction.
</span><span class="typ">Transaction </span><span class="pln">previousTx </span><span class="pun">= </span><span class="typ">Transaction</span><span class="pun">([ </span><span class="typ">Output</span><span class="pun">(</span><span class="typ">Amount</span><span class="pun">(</span><span class="lit">100</span><span class="pun">), </span><span class="pln">key_pairs</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]<wbr/>.</span><span class="pln">address</span><span class="pun">) ]);

</span><span class="com">// Save
</span><span class="typ">Hash </span><span class="pln">previousHash </span><span class="pun">= </span><span class="pln">hashFull</span><span class="pun">(</span><span class="pln">previousTx</span><span class="pun">);
</span><span class="pln">storage<wbr/></span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="pln">previousTx</span><span class="pun">);

</span><span class="com">// Creates the second transaction.
</span><span class="typ">Transaction </span><span class="pln">secondTx </span><span class="pun">= </span><span class="typ">Transaction</span><span class="pun">(
    [
        </span><span class="typ">Input</span><span class="pun">(</span><span class="pln">previousHash</span><span class="pun">, </span><span class="lit">0</span><span class="pun">)
    ],
    [
        </span><span class="typ">Output</span><span class="pun">(</span><span class="typ">Amount</span><span class="pun">(</span><span class="lit">50</span><span class="pun">), </span><span class="pln">key_pairs</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]<wbr/>.</span><span class="pln">address</span><span class="pun">)
    ]
);

</span><span class="pln">secondTx<wbr/></span><span class="pun">.</span><span class="pln">inputs</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]<wbr/>.</span><span class="pln">unlock </span><span class="pun">= </span><span class="pln">signUnlock</span><span class="pun">(</span><span class="pln">key_pairs</span><span class="pun">[</span><span class="lit">0</span><span class="pun">], </span><span class="pln">secondTx</span><span class="pun">);

</span><span class="com">// It is validated. (the sum of `Output` &lt; the sum of `Input`)
</span><span class="kwd">assert</span><span class="pun">(</span><span class="pln">secondTx<wbr/></span><span class="pun">.</span><span class="pln">isValid</span><span class="pun">(<a href="../../../../agora/consensus/validation/Transaction/is_invalid_reason.html#engine"></span><span class="pln">engine</span></a><span class="pun">, </span><span class="pln">storage<wbr/></span><span class="pun">.</span><span class="pln">getUTXOFinder</span><span class="pun">(), </span><span class="typ">Height</span><span class="pun">(</span><span class="lit">0</span><span class="pun">), </span><span class="pln">checker</span><span class="pun">),
       </span><span class="pln">format</span><span class="pun">(</span><span class="str">"Transaction data is not validated %s"</span><span class="pun">, </span><span class="pln">secondTx</span><span class="pun">));

</span><span class="pln">secondTx<wbr/></span><span class="pun">.</span><span class="pln">outputs </span><span class="pun">~= </span><span class="typ">Output</span><span class="pun">(</span><span class="typ">Amount</span><span class="pun">(</span><span class="lit">50</span><span class="pun">), </span><span class="pln">key_pairs</span><span class="pun">[</span><span class="lit">2</span><span class="pun">]<wbr/>.</span><span class="pln">address</span><span class="pun">);
</span><span class="pln">secondTx<wbr/></span><span class="pun">.</span><span class="pln">outputs<wbr/></span><span class="pun">.</span><span class="pln">sort</span><span class="pun">;
</span><span class="pln">secondTx<wbr/></span><span class="pun">.</span><span class="pln">inputs</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]<wbr/>.</span><span class="pln">unlock </span><span class="pun">= </span><span class="pln">signUnlock</span><span class="pun">(</span><span class="pln">key_pairs</span><span class="pun">[</span><span class="lit">0</span><span class="pun">], </span><span class="pln">secondTx</span><span class="pun">);

</span><span class="com">// It is validated. (the sum of `Output` == the sum of `Input`)
</span><span class="kwd">assert</span><span class="pun">(</span><span class="pln">secondTx<wbr/></span><span class="pun">.</span><span class="pln">isValid</span><span class="pun">(<a href="../../../../agora/consensus/validation/Transaction/is_invalid_reason.html#engine"></span><span class="pln">engine</span></a><span class="pun">, </span><span class="pln">storage<wbr/></span><span class="pun">.</span><span class="pln">getUTXOFinder</span><span class="pun">(), </span><span class="typ">Height</span><span class="pun">(</span><span class="lit">0</span><span class="pun">), </span><span class="pln">checker</span><span class="pun">),
       </span><span class="pln">format</span><span class="pun">(</span><span class="str">"Transaction data is not validated %s"</span><span class="pun">, </span><span class="pln">secondTx</span><span class="pun">));

</span><span class="pln">secondTx<wbr/></span><span class="pun">.</span><span class="pln">outputs </span><span class="pun">~= </span><span class="typ">Output</span><span class="pun">(</span><span class="typ">Amount</span><span class="pun">(</span><span class="lit">50</span><span class="pun">), </span><span class="pln">key_pairs</span><span class="pun">[</span><span class="lit">3</span><span class="pun">]<wbr/>.</span><span class="pln">address</span><span class="pun">);
</span><span class="pln">secondTx<wbr/></span><span class="pun">.</span><span class="pln">outputs<wbr/></span><span class="pun">.</span><span class="pln">sort</span><span class="pun">;
</span><span class="pln">secondTx<wbr/></span><span class="pun">.</span><span class="pln">inputs</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]<wbr/>.</span><span class="pln">unlock </span><span class="pun">= </span><span class="pln">signUnlock</span><span class="pun">(</span><span class="pln">key_pairs</span><span class="pun">[</span><span class="lit">0</span><span class="pun">], </span><span class="pln">secondTx</span><span class="pun">);

</span><span class="com">// It isn't validated. (the sum of `Output` &gt; the sum of `Input`)
</span><span class="kwd">assert</span><span class="pun">(!</span><span class="pln">secondTx<wbr/></span><span class="pun">.</span><span class="pln">isValid</span><span class="pun">(<a href="../../../../agora/consensus/validation/Transaction/is_invalid_reason.html#engine"></span><span class="pln">engine</span></a><span class="pun">, </span><span class="pln">storage<wbr/></span><span class="pun">.</span><span class="pln">getUTXOFinder</span><span class="pun">(), </span><span class="typ">Height</span><span class="pun">(</span><span class="lit">0</span><span class="pun">), </span><span class="pln">checker</span><span class="pun">),
       </span><span class="pln">format</span><span class="pun">(</span><span class="str">"Transaction data is not validated %s"</span><span class="pun">, </span><span class="pln">secondTx</span><span class="pun">));
</span></code></pre>
</section>
<section><h2>Example</h2>
<p>negative output amounts disallowed
</p>
<pre class="code"><code class="lang-d"><span class="kwd">scope <a href="../../../../agora/consensus/validation/Transaction/is_invalid_reason.html#engine"></span><span class="pln">engine</span></a><span class="pln"> </span><span class="pun">= </span><span class="kwd">new </span><span class="typ">Engine</span><span class="pun">();
</span><span class="typ">KeyPair</span><span class="pun">[] </span><span class="pln">key_pairs </span><span class="pun">= [</span><span class="typ">KeyPair<wbr/></span><span class="pun">.</span><span class="pln">random</span><span class="pun">(), </span><span class="typ">KeyPair<wbr/></span><span class="pun">.</span><span class="pln">random</span><span class="pun">()];
</span><span class="typ">Transaction </span><span class="pln">tx_1 </span><span class="pun">= </span><span class="typ">Transaction</span><span class="pun">([ </span><span class="typ">Output</span><span class="pun">(</span><span class="typ">Amount</span><span class="pun">(</span><span class="lit">1000</span><span class="pun">), </span><span class="pln">key_pairs</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]<wbr/>.</span><span class="pln">address</span><span class="pun">) ]);
</span><span class="typ">Hash </span><span class="pln">tx_1_hash </span><span class="pun">= </span><span class="pln">hashFull</span><span class="pun">(</span><span class="pln">tx_1</span><span class="pun">);

</span><span class="kwd">scope </span><span class="pln">payload_checker </span><span class="pun">= </span><span class="kwd">new </span><span class="typ">FeeManager</span><span class="pun">();
</span><span class="kwd">scope </span><span class="pln">checker </span><span class="pun">= &amp;</span><span class="pln">payload_checker<wbr/></span><span class="pun">.</span><span class="pln">check</span><span class="pun">;

</span><span class="kwd">scope </span><span class="pln">storage </span><span class="pun">= </span><span class="kwd">new </span><span class="typ">MemoryUTXOSet</span><span class="pun">;
</span><span class="pln">storage<wbr/></span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="pln">tx_1</span><span class="pun">);

</span><span class="com">// Creates the second transaction.
</span><span class="typ">Transaction </span><span class="pln">tx_2 </span><span class="pun">= </span><span class="typ">Transaction</span><span class="pun">(
    [</span><span class="typ">Input</span><span class="pun">(</span><span class="pln">tx_1_hash</span><span class="pun">, </span><span class="lit">0</span><span class="pun">)],
    </span><span class="com">// oops
    </span><span class="pun">[</span><span class="typ">Output</span><span class="pun">(</span><span class="typ">Amount<wbr/></span><span class="pun">.</span><span class="pln">invalid</span><span class="pun">(-</span><span class="lit">400_000</span><span class="pun">), </span><span class="pln">key_pairs</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]<wbr/>.</span><span class="pln">address</span><span class="pun">)]);

</span><span class="pln">tx_2<wbr/></span><span class="pun">.</span><span class="pln">inputs</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]<wbr/>.</span><span class="pln">unlock </span><span class="pun">= </span><span class="pln">signUnlock</span><span class="pun">(</span><span class="pln">key_pairs</span><span class="pun">[</span><span class="lit">0</span><span class="pun">], </span><span class="pln">tx_2</span><span class="pun">);

</span><span class="kwd">assert</span><span class="pun">(!</span><span class="pln">tx_2<wbr/></span><span class="pun">.</span><span class="pln">isValid</span><span class="pun">(<a href="../../../../agora/consensus/validation/Transaction/is_invalid_reason.html#engine"></span><span class="pln">engine</span></a><span class="pun">, </span><span class="pln">storage<wbr/></span><span class="pun">.</span><span class="pln">getUTXOFinder</span><span class="pun">(), </span><span class="typ">Height</span><span class="pun">(</span><span class="lit">0</span><span class="pun">), </span><span class="pln">checker</span><span class="pun">));

</span><span class="com">// Creates the third transaction.
// Reject a transaction whose output value is zero
</span><span class="typ">Transaction </span><span class="pln">tx_3 </span><span class="pun">= </span><span class="typ">Transaction</span><span class="pun">(
    [</span><span class="typ">Input</span><span class="pun">(</span><span class="pln">tx_1_hash</span><span class="pun">, </span><span class="lit">0</span><span class="pun">)],
    [</span><span class="typ">Output</span><span class="pun">(</span><span class="typ">Amount<wbr/></span><span class="pun">.</span><span class="pln">invalid</span><span class="pun">(</span><span class="lit">0</span><span class="pun">), </span><span class="pln">key_pairs</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]<wbr/>.</span><span class="pln">address</span><span class="pun">)]);

</span><span class="pln">tx_3<wbr/></span><span class="pun">.</span><span class="pln">inputs</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]<wbr/>.</span><span class="pln">unlock </span><span class="pun">= </span><span class="pln">signUnlock</span><span class="pun">(</span><span class="pln">key_pairs</span><span class="pun">[</span><span class="lit">0</span><span class="pun">], </span><span class="pln">tx_3</span><span class="pun">);

</span><span class="kwd">assert</span><span class="pun">(!</span><span class="pln">tx_3<wbr/></span><span class="pun">.</span><span class="pln">isValid</span><span class="pun">(<a href="../../../../agora/consensus/validation/Transaction/is_invalid_reason.html#engine"></span><span class="pln">engine</span></a><span class="pun">, </span><span class="pln">storage<wbr/></span><span class="pun">.</span><span class="pln">getUTXOFinder</span><span class="pun">(), </span><span class="typ">Height</span><span class="pun">(</span><span class="lit">0</span><span class="pun">), </span><span class="pln">checker</span><span class="pun">));
</span></code></pre>
</section>
<section><h2>Example</h2>
<p>This creates a new transaction and signs it as a publickey
of the previous transaction to create and validate the input.
</p>
<pre class="code"><code class="lang-d"><span class="kwd">scope <a href="../../../../agora/consensus/validation/Transaction/is_invalid_reason.html#engine"></span><span class="pln">engine</span></a><span class="pln"> </span><span class="pun">= </span><span class="kwd">new </span><span class="typ">Engine</span><span class="pun">();
</span><span class="kwd">scope </span><span class="pln">storage </span><span class="pun">= </span><span class="kwd">new </span><span class="typ">MemoryUTXOSet</span><span class="pun">;

</span><span class="kwd">immutable</span><span class="pun">(</span><span class="typ">KeyPair</span><span class="pun">)[] </span><span class="pln">key_pairs</span><span class="pun">;
</span><span class="pln">key_pairs </span><span class="pun">~= </span><span class="typ">KeyPair<wbr/></span><span class="pun">.</span><span class="pln">random</span><span class="pun">();
</span><span class="pln">key_pairs </span><span class="pun">~= </span><span class="typ">KeyPair<wbr/></span><span class="pun">.</span><span class="pln">random</span><span class="pun">();
</span><span class="pln">key_pairs </span><span class="pun">~= </span><span class="typ">KeyPair<wbr/></span><span class="pun">.</span><span class="pln">random</span><span class="pun">();

</span><span class="kwd">scope </span><span class="pln">payload_checker </span><span class="pun">= </span><span class="kwd">new </span><span class="typ">FeeManager</span><span class="pun">();
</span><span class="kwd">scope </span><span class="pln">checker </span><span class="pun">= &amp;</span><span class="pln">payload_checker<wbr/></span><span class="pun">.</span><span class="pln">check</span><span class="pun">;

</span><span class="com">// Create the first transaction.
</span><span class="typ">Transaction </span><span class="pln">genesisTx </span><span class="pun">= </span><span class="typ">Transaction</span><span class="pun">([ </span><span class="typ">Output</span><span class="pun">(</span><span class="typ">Amount</span><span class="pun">(</span><span class="lit">100_000</span><span class="pun">), </span><span class="pln">key_pairs</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]<wbr/>.</span><span class="pln">address</span><span class="pun">) ]);
</span><span class="typ">Hash </span><span class="pln">genesisHash </span><span class="pun">= </span><span class="pln">hashFull</span><span class="pun">(</span><span class="pln">genesisTx</span><span class="pun">);
</span><span class="pln">storage<wbr/></span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="pln">genesisTx</span><span class="pun">);

</span><span class="com">// Create the second transaction.
</span><span class="typ">Transaction </span><span class="pln">tx1 </span><span class="pun">= </span><span class="typ">Transaction</span><span class="pun">(
    [
        </span><span class="typ">Input</span><span class="pun">(</span><span class="pln">genesisHash</span><span class="pun">, </span><span class="lit">0</span><span class="pun">)
    ],
    [
        </span><span class="typ">Output</span><span class="pun">(</span><span class="typ">Amount</span><span class="pun">(</span><span class="lit">1_000</span><span class="pun">), </span><span class="pln">key_pairs</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]<wbr/>.</span><span class="pln">address</span><span class="pun">)
    ]
);

</span><span class="com">// Signs the previous hash value.
</span><span class="typ">Hash </span><span class="pln">tx1Hash </span><span class="pun">= </span><span class="pln">hashFull</span><span class="pun">(</span><span class="pln">tx1</span><span class="pun">);
</span><span class="pln">tx1<wbr/></span><span class="pun">.</span><span class="pln">inputs</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]<wbr/>.</span><span class="pln">unlock </span><span class="pun">= </span><span class="pln">signUnlock</span><span class="pun">(</span><span class="pln">key_pairs</span><span class="pun">[</span><span class="lit">0</span><span class="pun">], </span><span class="pln">tx1</span><span class="pun">);
</span><span class="pln">storage<wbr/></span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="pln">tx1</span><span class="pun">);

</span><span class="kwd">assert</span><span class="pun">(</span><span class="pln">tx1<wbr/></span><span class="pun">.</span><span class="pln">isValid</span><span class="pun">(<a href="../../../../agora/consensus/validation/Transaction/is_invalid_reason.html#engine"></span><span class="pln">engine</span></a><span class="pun">, </span><span class="pln">storage<wbr/></span><span class="pun">.</span><span class="pln">getUTXOFinder</span><span class="pun">(), </span><span class="typ">Height</span><span class="pun">(</span><span class="lit">0</span><span class="pun">), </span><span class="pln">checker</span><span class="pun">),
       </span><span class="pln">format</span><span class="pun">(</span><span class="str">"Transaction signature is not validated %s"</span><span class="pun">, </span><span class="pln">tx1</span><span class="pun">));

</span><span class="kwd">import </span><span class="pln">agora<wbr/></span><span class="pun">.</span><span class="pln">serialization<wbr/></span><span class="pun">.</span><span class="typ">Serializer</span><span class="pun">;
</span><span class="kwd">auto </span><span class="pln">dupe </span><span class="pun">= </span><span class="pln">tx1<wbr/></span><span class="pun">.</span><span class="pln">serializeFull<wbr/></span><span class="pun">.</span><span class="pln">deserializeFull</span><span class="pun">!</span><span class="typ">Transaction</span><span class="pun">;
</span><span class="kwd">assert</span><span class="pun">(</span><span class="pln">dupe<wbr/></span><span class="pun">.</span><span class="pln">isValid</span><span class="pun">(<a href="../../../../agora/consensus/validation/Transaction/is_invalid_reason.html#engine"></span><span class="pln">engine</span></a><span class="pun">, </span><span class="pln">storage<wbr/></span><span class="pun">.</span><span class="pln">getUTXOFinder</span><span class="pun">(), </span><span class="typ">Height</span><span class="pun">(</span><span class="lit">0</span><span class="pun">), </span><span class="pln">checker</span><span class="pun">),
       </span><span class="pln">format</span><span class="pun">(</span><span class="str">"Transaction signature is not validated %s"</span><span class="pun">, </span><span class="pln">tx1</span><span class="pun">));
</span><span class="pln">dupe<wbr/></span><span class="pun">.</span><span class="pln">outputs</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]<wbr/>.</span><span class="pln">lock<wbr/></span><span class="pun">.</span><span class="pln">bytes<wbr/></span><span class="pun">.</span><span class="pln">length </span><span class="pun">= </span><span class="lit">0</span><span class="pun">;
</span><span class="kwd">assert</span><span class="pun">(</span><span class="pln">dupe<wbr/></span><span class="pun">.</span><span class="pln">isInvalidReason</span><span class="pun">(<a href="../../../../agora/consensus/validation/Transaction/is_invalid_reason.html#engine"></span><span class="pln">engine</span></a><span class="pun">, </span><span class="pln">storage<wbr/></span><span class="pun">.</span><span class="pln">getUTXOFinder</span><span class="pun">(), </span><span class="typ">Height</span><span class="pun">(</span><span class="lit">0</span><span class="pun">), </span><span class="pln">checker</span><span class="pun">, </span><span class="pln">toDelegate</span><span class="pun">(</span><span class="pln">utGetPenaltyDeposit</span><span class="pun">))
    == </span><span class="str">"LockType.Key requires 32-byte key argument in the lock script"</span><span class="pun">);

</span><span class="typ">Transaction </span><span class="pln">tx2 </span><span class="pun">= </span><span class="typ">Transaction</span><span class="pun">(
    [
        </span><span class="typ">Input</span><span class="pun">(</span><span class="pln">tx1Hash</span><span class="pun">, </span><span class="lit">0</span><span class="pun">)
    ],
    [
        </span><span class="typ">Output</span><span class="pun">(</span><span class="typ">Amount</span><span class="pun">(</span><span class="lit">1_000</span><span class="pun">), </span><span class="pln">key_pairs</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]<wbr/>.</span><span class="pln">address</span><span class="pun">)
    ]
);

</span><span class="typ">Hash </span><span class="pln">tx2Hash </span><span class="pun">= </span><span class="pln">hashFull</span><span class="pun">(</span><span class="pln">tx2</span><span class="pun">);
</span><span class="com">// Sign with incorrect key
</span><span class="pln">tx2<wbr/></span><span class="pun">.</span><span class="pln">inputs</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]<wbr/>.</span><span class="pln">unlock </span><span class="pun">= </span><span class="pln">signUnlock</span><span class="pun">(</span><span class="pln">key_pairs</span><span class="pun">[</span><span class="lit">2</span><span class="pun">], </span><span class="pln">tx2</span><span class="pun">);
</span><span class="pln">storage<wbr/></span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="pln">tx2</span><span class="pun">);
</span><span class="kwd">assert</span><span class="pun">(!</span><span class="pln">tx2<wbr/></span><span class="pun">.</span><span class="pln">isValid</span><span class="pun">(<a href="../../../../agora/consensus/validation/Transaction/is_invalid_reason.html#engine"></span><span class="pln">engine</span></a><span class="pun">, </span><span class="pln">storage<wbr/></span><span class="pun">.</span><span class="pln">getUTXOFinder</span><span class="pun">(), </span><span class="typ">Height</span><span class="pun">(</span><span class="lit">0</span><span class="pun">), </span><span class="pln">checker</span><span class="pun">));
</span></code></pre>
</section>
<section><h2>Example</h2>
<p>verify transactions associated with freezing
</p>
<pre class="code"><code class="lang-d"><span class="kwd">scope <a href="../../../../agora/consensus/validation/Transaction/is_invalid_reason.html#engine"></span><span class="pln">engine</span></a><span class="pln"> </span><span class="pun">= </span><span class="kwd">new </span><span class="typ">Engine</span><span class="pun">();
</span><span class="kwd">scope </span><span class="pln">storage </span><span class="pun">= </span><span class="kwd">new </span><span class="typ">MemoryUTXOSet</span><span class="pun">();
</span><span class="typ">KeyPair</span><span class="pun">[] </span><span class="pln">key_pairs </span><span class="pun">= [</span><span class="typ">KeyPair<wbr/></span><span class="pun">.</span><span class="pln">random</span><span class="pun">, </span><span class="typ">KeyPair<wbr/></span><span class="pun">.</span><span class="pln">random</span><span class="pun">, </span><span class="typ">KeyPair<wbr/></span><span class="pun">.</span><span class="pln">random</span><span class="pun">, </span><span class="typ">KeyPair<wbr/></span><span class="pun">.</span><span class="pln">random</span><span class="pun">];

</span><span class="kwd">scope </span><span class="pln">payload_checker </span><span class="pun">= </span><span class="kwd">new </span><span class="typ">FeeManager</span><span class="pun">();
</span><span class="kwd">scope </span><span class="pln">checker </span><span class="pun">= &amp;</span><span class="pln">payload_checker<wbr/></span><span class="pun">.</span><span class="pln">check</span><span class="pun">;

</span><span class="typ">Transaction </span><span class="pln">secondTx</span><span class="pun">;
</span><span class="typ">Hash </span><span class="pln">previousHash</span><span class="pun">;

</span><span class="com">// When the privious transaction type is `Payment`, second transaction type is `Freeze`.
// Second transaction is valid.
</span><span class="pun">{
    </span><span class="pln">storage<wbr/></span><span class="pun">.</span><span class="pln">clear</span><span class="pun">;
    </span><span class="com">// Create the previous transaction with type `OutputType.Payment`
    </span><span class="typ">Transaction </span><span class="pln">previousTx </span><span class="pun">= </span><span class="typ">Transaction</span><span class="pun">([ </span><span class="typ">Output</span><span class="pun">(</span><span class="typ">Amount<wbr/></span><span class="pun">.</span><span class="typ">MinFreezeAmount </span><span class="pun">+
    </span><span class="lit">10_000<wbr/></span><span class="pun">.</span><span class="pln">coins</span><span class="pun">, </span><span class="pln">key_pairs</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]<wbr/>.</span><span class="pln">address</span><span class="pun">) ]);
    </span><span class="pln">previousHash </span><span class="pun">= </span><span class="pln">hashFull</span><span class="pun">(</span><span class="pln">previousTx</span><span class="pun">);
    </span><span class="kwd">foreach </span><span class="pun">(</span><span class="pln">idx</span><span class="pun">, </span><span class="pln">output</span><span class="pun">; </span><span class="pln">previousTx<wbr/></span><span class="pun">.</span><span class="pln">outputs</span><span class="pun">)
    {
        </span><span class="kwd">const </span><span class="typ">Hash </span><span class="pln">utxo_hash </span><span class="pun">= </span><span class="pln">hashMulti</span><span class="pun">(</span><span class="pln">previousHash</span><span class="pun">, </span><span class="pln">idx</span><span class="pun">);
        </span><span class="kwd">const </span><span class="pln">UTXO utxo_value </span><span class="pun">= {
            </span><span class="pln">unlock_height</span><span class="pun">: </span><span class="lit">0</span><span class="pun">,
            </span><span class="pln">output</span><span class="pun">: </span><span class="pln">output
        </span><span class="pun">};
        </span><span class="pln">storage</span><span class="pun">[</span><span class="pln">utxo_hash</span><span class="pun">] = </span><span class="pln">utxo_value</span><span class="pun">;
    }

    </span><span class="com">// Creates the freezing transaction.
    </span><span class="pln">secondTx </span><span class="pun">= </span><span class="typ">Transaction</span><span class="pun">([</span><span class="typ">Input</span><span class="pun">(</span><span class="pln">previousHash</span><span class="pun">, </span><span class="lit">0</span><span class="pun">)],
        [</span><span class="typ">Output</span><span class="pun">(</span><span class="typ">Amount<wbr/></span><span class="pun">.</span><span class="typ">MinFreezeAmount</span><span class="pun">, </span><span class="pln">key_pairs</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]<wbr/>.</span><span class="pln">address</span><span class="pun">, </span><span class="typ">OutputType<wbr/></span><span class="pun">.</span><span class="typ">Freeze</span><span class="pun">)]
    );
    </span><span class="pln">secondTx<wbr/></span><span class="pun">.</span><span class="pln">inputs</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]<wbr/>.</span><span class="pln">unlock </span><span class="pun">= </span><span class="pln">signUnlock</span><span class="pun">(</span><span class="pln">key_pairs</span><span class="pun">[</span><span class="lit">0</span><span class="pun">], </span><span class="pln">secondTx</span><span class="pun">);

    </span><span class="com">// Second Transaction is valid.
    </span><span class="kwd">assert</span><span class="pun">(</span><span class="pln">secondTx<wbr/></span><span class="pun">.</span><span class="pln">isValid</span><span class="pun">(<a href="../../../../agora/consensus/validation/Transaction/is_invalid_reason.html#engine"></span><span class="pln">engine</span></a><span class="pun">, </span><span class="pln">storage<wbr/></span><span class="pun">.</span><span class="pln">getUTXOFinder</span><span class="pun">(), </span><span class="typ">Height</span><span class="pun">(</span><span class="lit">0</span><span class="pun">), </span><span class="pln">checker</span><span class="pun">));
}

</span><span class="com">// When the privious transaction type is `Freeze`, second transaction type is `Freeze`.
// Second transaction is invalid.
</span><span class="pun">{
    </span><span class="pln">storage<wbr/></span><span class="pun">.</span><span class="pln">clear</span><span class="pun">;
    </span><span class="com">// Create the previous transaction with type `OutputType.Payment`
    </span><span class="typ">Transaction </span><span class="pln">previousTx </span><span class="pun">= </span><span class="typ">Transaction</span><span class="pun">([ </span><span class="typ">Output</span><span class="pun">(</span><span class="typ">Amount<wbr/></span><span class="pun">.</span><span class="typ">MinFreezeAmount</span><span class="pun">, </span><span class="pln">key_pairs</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]<wbr/>.</span><span class="pln">address</span><span class="pun">, </span><span class="typ">OutputType<wbr/></span><span class="pun">.</span><span class="typ">Freeze</span><span class="pun">) ]);
    </span><span class="pln">previousHash </span><span class="pun">= </span><span class="pln">hashFull</span><span class="pun">(</span><span class="pln">previousTx</span><span class="pun">);
    </span><span class="kwd">foreach </span><span class="pun">(</span><span class="pln">idx</span><span class="pun">, </span><span class="pln">output</span><span class="pun">; </span><span class="pln">previousTx<wbr/></span><span class="pun">.</span><span class="pln">outputs</span><span class="pun">)
    {
        </span><span class="kwd">const </span><span class="typ">Hash </span><span class="pln">utxo_hash </span><span class="pun">= </span><span class="pln">hashMulti</span><span class="pun">(</span><span class="pln">previousHash</span><span class="pun">, </span><span class="pln">idx</span><span class="pun">);
        </span><span class="kwd">const </span><span class="pln">UTXO utxo_value </span><span class="pun">= {
            </span><span class="pln">unlock_height</span><span class="pun">: </span><span class="lit">0</span><span class="pun">,
            </span><span class="pln">output</span><span class="pun">: </span><span class="pln">output
        </span><span class="pun">};
        </span><span class="pln">storage</span><span class="pun">[</span><span class="pln">utxo_hash</span><span class="pun">] = </span><span class="pln">utxo_value</span><span class="pun">;
    }

    </span><span class="com">// Creates the freezing transaction.
    </span><span class="pln">secondTx </span><span class="pun">= </span><span class="typ">Transaction</span><span class="pun">(
        [</span><span class="typ">Input</span><span class="pun">(</span><span class="pln">previousHash</span><span class="pun">, </span><span class="lit">0</span><span class="pun">)],
        [</span><span class="typ">Output</span><span class="pun">(</span><span class="typ">Amount<wbr/></span><span class="pun">.</span><span class="typ">MinFreezeAmount</span><span class="pun">, </span><span class="pln">key_pairs</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]<wbr/>.</span><span class="pln">address</span><span class="pun">, </span><span class="typ">OutputType<wbr/></span><span class="pun">.</span><span class="typ">Freeze</span><span class="pun">)]
    );
    </span><span class="pln">secondTx<wbr/></span><span class="pun">.</span><span class="pln">inputs</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]<wbr/>.</span><span class="pln">unlock </span><span class="pun">= </span><span class="pln">signUnlock</span><span class="pun">(</span><span class="pln">key_pairs</span><span class="pun">[</span><span class="lit">0</span><span class="pun">], </span><span class="pln">secondTx</span><span class="pun">);

    </span><span class="com">// Second Transaction is invalid.
    </span><span class="kwd">assert</span><span class="pun">(!</span><span class="pln">secondTx<wbr/></span><span class="pun">.</span><span class="pln">isValid</span><span class="pun">(<a href="../../../../agora/consensus/validation/Transaction/is_invalid_reason.html#engine"></span><span class="pln">engine</span></a><span class="pun">, </span><span class="pln">storage<wbr/></span><span class="pun">.</span><span class="pln">getUTXOFinder</span><span class="pun">(), </span><span class="typ">Height</span><span class="pun">(</span><span class="lit">0</span><span class="pun">), </span><span class="pln">checker</span><span class="pun">));
}

</span><span class="com">// When the privious transaction with not enough amount at freezing.
// Second transaction is invalid.
</span><span class="pun">{
    </span><span class="pln">storage<wbr/></span><span class="pun">.</span><span class="pln">clear</span><span class="pun">;
    </span><span class="com">// Create the previous transaction with type `OutputType.Payment`
    </span><span class="typ">Transaction </span><span class="pln">previousTx </span><span class="pun">= </span><span class="typ">Transaction</span><span class="pun">([ </span><span class="typ">Output</span><span class="pun">(</span><span class="typ">Amount</span><span class="pun">(</span><span class="lit">100_000_000_000L</span><span class="pun">), </span><span class="pln">key_pairs</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]<wbr/>.</span><span class="pln">address</span><span class="pun">) ]);
    </span><span class="pln">previousHash </span><span class="pun">= </span><span class="pln">hashFull</span><span class="pun">(</span><span class="pln">previousTx</span><span class="pun">);
    </span><span class="kwd">foreach </span><span class="pun">(</span><span class="pln">idx</span><span class="pun">, </span><span class="pln">output</span><span class="pun">; </span><span class="pln">previousTx<wbr/></span><span class="pun">.</span><span class="pln">outputs</span><span class="pun">)
    {
        </span><span class="kwd">const </span><span class="typ">Hash </span><span class="pln">utxo_hash </span><span class="pun">= </span><span class="pln">hashMulti</span><span class="pun">(</span><span class="pln">previousHash</span><span class="pun">, </span><span class="pln">idx</span><span class="pun">);
        </span><span class="kwd">const </span><span class="pln">UTXO utxo_value </span><span class="pun">= {
            </span><span class="pln">unlock_height</span><span class="pun">: </span><span class="lit">0</span><span class="pun">,
            </span><span class="pln">output</span><span class="pun">: </span><span class="pln">output
        </span><span class="pun">};
        </span><span class="pln">storage</span><span class="pun">[</span><span class="pln">utxo_hash</span><span class="pun">] = </span><span class="pln">utxo_value</span><span class="pun">;
    }

    </span><span class="com">// Creates the freezing transaction.
    </span><span class="pln">secondTx </span><span class="pun">= </span><span class="typ">Transaction</span><span class="pun">(
        [</span><span class="typ">Input</span><span class="pun">(</span><span class="pln">previousHash</span><span class="pun">, </span><span class="lit">0</span><span class="pun">)],
        [</span><span class="typ">Output</span><span class="pun">(</span><span class="typ">Amount</span><span class="pun">(</span><span class="lit">100_000_000_000L</span><span class="pun">), </span><span class="pln">key_pairs</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]<wbr/>.</span><span class="pln">address</span><span class="pun">, </span><span class="typ">OutputType<wbr/></span><span class="pun">.</span><span class="typ">Freeze</span><span class="pun">)]
    );
    </span><span class="pln">secondTx<wbr/></span><span class="pun">.</span><span class="pln">inputs</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]<wbr/>.</span><span class="pln">unlock </span><span class="pun">= </span><span class="pln">signUnlock</span><span class="pun">(</span><span class="pln">key_pairs</span><span class="pun">[</span><span class="lit">0</span><span class="pun">], </span><span class="pln">secondTx</span><span class="pun">);

    </span><span class="com">// Second Transaction is invalid.
    </span><span class="kwd">assert</span><span class="pun">(!</span><span class="pln">secondTx<wbr/></span><span class="pun">.</span><span class="pln">isValid</span><span class="pun">(<a href="../../../../agora/consensus/validation/Transaction/is_invalid_reason.html#engine"></span><span class="pln">engine</span></a><span class="pun">, </span><span class="pln">storage<wbr/></span><span class="pun">.</span><span class="pln">getUTXOFinder</span><span class="pun">(), </span><span class="typ">Height</span><span class="pun">(</span><span class="lit">0</span><span class="pun">), </span><span class="pln">checker</span><span class="pun">));
}

</span><span class="com">// When the privious transaction with too many amount at freezings.
// Second transaction is valid.
</span><span class="pun">{
    </span><span class="com">// Create the previous transaction with type `OutputType.Payment`
    </span><span class="typ">Transaction </span><span class="pln">previousTx </span><span class="pun">= </span><span class="typ">Transaction</span><span class="pun">([ </span><span class="typ">Output</span><span class="pun">(</span><span class="typ">Amount</span><span class="pun">(</span><span class="lit">500_000_000_000L</span><span class="pun">), </span><span class="pln">key_pairs</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]<wbr/>.</span><span class="pln">address</span><span class="pun">) ]);
    </span><span class="pln">previousHash </span><span class="pun">= </span><span class="pln">hashFull</span><span class="pun">(</span><span class="pln">previousTx</span><span class="pun">);
    </span><span class="kwd">foreach </span><span class="pun">(</span><span class="pln">idx</span><span class="pun">, </span><span class="pln">output</span><span class="pun">; </span><span class="pln">previousTx<wbr/></span><span class="pun">.</span><span class="pln">outputs</span><span class="pun">)
    {
        </span><span class="kwd">const </span><span class="typ">Hash </span><span class="pln">utxo_hash </span><span class="pun">= </span><span class="pln">hashMulti</span><span class="pun">(</span><span class="pln">previousHash</span><span class="pun">, </span><span class="pln">idx</span><span class="pun">);
        </span><span class="kwd">const </span><span class="pln">UTXO utxo_value </span><span class="pun">= {
            </span><span class="pln">unlock_height</span><span class="pun">: </span><span class="lit">0</span><span class="pun">,
            </span><span class="pln">output</span><span class="pun">: </span><span class="pln">output
        </span><span class="pun">};
        </span><span class="pln">storage</span><span class="pun">[</span><span class="pln">utxo_hash</span><span class="pun">] = </span><span class="pln">utxo_value</span><span class="pun">;
    }

    </span><span class="com">// Creates the freezing transaction.
    </span><span class="pln">secondTx </span><span class="pun">= </span><span class="typ">Transaction</span><span class="pun">(
        [</span><span class="typ">Input</span><span class="pun">(</span><span class="pln">previousHash</span><span class="pun">, </span><span class="lit">0</span><span class="pun">)],
        [</span><span class="typ">Output</span><span class="pun">(</span><span class="typ">Amount</span><span class="pun">(</span><span class="lit">500_000_000_000L</span><span class="pun">) - </span><span class="lit">10_000<wbr/></span><span class="pun">.</span><span class="pln">coins</span><span class="pun">, </span><span class="pln">key_pairs</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]<wbr/>.</span><span class="pln">address</span><span class="pun">, </span><span class="typ">OutputType<wbr/></span><span class="pun">.</span><span class="typ">Freeze</span><span class="pun">)]
    );
    </span><span class="pln">secondTx<wbr/></span><span class="pun">.</span><span class="pln">inputs</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]<wbr/>.</span><span class="pln">unlock </span><span class="pun">= </span><span class="pln">signUnlock</span><span class="pun">(</span><span class="pln">key_pairs</span><span class="pun">[</span><span class="lit">0</span><span class="pun">], </span><span class="pln">secondTx</span><span class="pun">);

    </span><span class="com">// Second Transaction is valid.
    </span><span class="kwd">assert</span><span class="pun">(</span><span class="pln">secondTx<wbr/></span><span class="pun">.</span><span class="pln">isValid</span><span class="pun">(<a href="../../../../agora/consensus/validation/Transaction/is_invalid_reason.html#engine"></span><span class="pln">engine</span></a><span class="pun">, </span><span class="pln">storage<wbr/></span><span class="pun">.</span><span class="pln">getUTXOFinder</span><span class="pun">(), </span><span class="typ">Height</span><span class="pun">(</span><span class="lit">0</span><span class="pun">), </span><span class="pln">checker</span><span class="pun">));
}

</span><span class="com">// When the freeze TX does not include enough freezing fees
</span><span class="pun">{
    </span><span class="pln">storage<wbr/></span><span class="pun">.</span><span class="pln">clear</span><span class="pun">;
    </span><span class="com">// Create the previous transaction with type `OutputType.Payment`
    </span><span class="typ">Transaction </span><span class="pln">previousTx </span><span class="pun">= </span><span class="typ">Transaction</span><span class="pun">([ </span><span class="typ">Output</span><span class="pun">((</span><span class="typ">Amount<wbr/></span><span class="pun">.</span><span class="typ">MinFreezeAmount </span><span class="pun">+ </span><span class="lit">9_999<wbr/></span><span class="pun">.</span><span class="pln">coins</span><span class="pun">) * </span><span class="lit">2</span><span class="pun">, </span><span class="pln">key_pairs</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]<wbr/>.</span><span class="pln">address</span><span class="pun">) ]);
    </span><span class="pln">previousHash </span><span class="pun">= </span><span class="pln">hashFull</span><span class="pun">(</span><span class="pln">previousTx</span><span class="pun">);
    </span><span class="kwd">foreach </span><span class="pun">(</span><span class="pln">idx</span><span class="pun">, </span><span class="pln">output</span><span class="pun">; </span><span class="pln">previousTx<wbr/></span><span class="pun">.</span><span class="pln">outputs</span><span class="pun">)
    {
        </span><span class="kwd">const </span><span class="typ">Hash </span><span class="pln">utxo_hash </span><span class="pun">= </span><span class="pln">hashMulti</span><span class="pun">(</span><span class="pln">previousHash</span><span class="pun">, </span><span class="pln">idx</span><span class="pun">);
        </span><span class="kwd">const </span><span class="pln">UTXO utxo_value </span><span class="pun">= {
            </span><span class="pln">unlock_height</span><span class="pun">: </span><span class="lit">0</span><span class="pun">,
            </span><span class="pln">output</span><span class="pun">: </span><span class="pln">output
        </span><span class="pun">};
        </span><span class="pln">storage</span><span class="pun">[</span><span class="pln">utxo_hash</span><span class="pun">] = </span><span class="pln">utxo_value</span><span class="pun">;
    }

    </span><span class="com">// Creates the freezing transaction.
    </span><span class="pln">secondTx </span><span class="pun">= </span><span class="typ">Transaction</span><span class="pun">(
        [</span><span class="typ">Input</span><span class="pun">(</span><span class="pln">previousHash</span><span class="pun">, </span><span class="lit">0</span><span class="pun">)],
        [</span><span class="typ">Output</span><span class="pun">(</span><span class="typ">Amount<wbr/></span><span class="pun">.</span><span class="typ">MinFreezeAmount</span><span class="pun">, </span><span class="pln">key_pairs</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]<wbr/>.</span><span class="pln">address</span><span class="pun">, </span><span class="typ">OutputType<wbr/></span><span class="pun">.</span><span class="typ">Freeze</span><span class="pun">),
        </span><span class="typ">Output</span><span class="pun">(</span><span class="typ">Amount<wbr/></span><span class="pun">.</span><span class="typ">MinFreezeAmount</span><span class="pun">, </span><span class="pln">key_pairs</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]<wbr/>.</span><span class="pln">address</span><span class="pun">, </span><span class="typ">OutputType<wbr/></span><span class="pun">.</span><span class="typ">Freeze</span><span class="pun">)]
    );
    </span><span class="pln">secondTx<wbr/></span><span class="pun">.</span><span class="pln">inputs</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]<wbr/>.</span><span class="pln">unlock </span><span class="pun">= </span><span class="pln">signUnlock</span><span class="pun">(</span><span class="pln">key_pairs</span><span class="pun">[</span><span class="lit">0</span><span class="pun">], </span><span class="pln">secondTx</span><span class="pun">);
    </span><span class="com">// Second Transaction is invalid.
    </span><span class="kwd">assert</span><span class="pun">(!</span><span class="pln">secondTx<wbr/></span><span class="pun">.</span><span class="pln">isValid</span><span class="pun">(<a href="../../../../agora/consensus/validation/Transaction/is_invalid_reason.html#engine"></span><span class="pln">engine</span></a><span class="pun">, </span><span class="pln">storage<wbr/></span><span class="pun">.</span><span class="pln">getUTXOFinder</span><span class="pun">(), </span><span class="typ">Height</span><span class="pun">(</span><span class="lit">0</span><span class="pun">), </span><span class="pln">checker</span><span class="pun">));
}
</span></code></pre>
</section>
<section><h2>Example</h2>
<p>Test validation of transactions associated with freezing
</p>

<p>Table of freezing status changes over time
</p>
<pre class="code"><code class="lang-d"><span class="pln">freezing status     </span><span class="pun">/ </span><span class="pln">melted     </span><span class="pun">/ </span><span class="pln">frozen     </span><span class="pun">/ </span><span class="pln">melting    </span><span class="pun">/ </span><span class="pln">melted</span></code></pre>
<p>block height        / N1         / N2         / N3         / N4
</p>
<pre class="code"><code class="lang-d"><span class="pln">condition to use    </span><span class="pun">/            / </span><span class="pln">N2 </span><span class="pun">&gt;= </span><span class="pln">N1</span><span class="pun">+</span><span class="lit">1 </span><span class="pun">/ </span><span class="pln">N3 </span><span class="pun">&gt;= </span><span class="pln">N2</span><span class="pun">+</span><span class="lit">1 </span><span class="pun">/ </span><span class="pln">N4 </span><span class="pun">&gt;= </span><span class="pln">N3</span><span class="pun">+</span><span class="lit">2016</span></code></pre>
<p>utxo unlock height  / N1+1       / N2+1       / N3+2016    / N4+1
</p>
<pre class="code"><code class="lang-d"><span class="pln">utxo type           </span><span class="pun">/ </span><span class="typ">Payment    </span><span class="pun">/ </span><span class="typ">Freeze     </span><span class="pun">/ </span><span class="typ">Payment    </span><span class="pun">/ </span><span class="typ">Payment</span></code></pre>
<pre class="code"><code class="lang-d"><span class="kwd">scope <a href="../../../../agora/consensus/validation/Transaction/is_invalid_reason.html#engine"></span><span class="pln">engine</span></a><span class="pln"> </span><span class="pun">= </span><span class="kwd">new </span><span class="typ">Engine</span><span class="pun">();
</span><span class="kwd">scope </span><span class="pln">storage </span><span class="pun">= </span><span class="kwd">new </span><span class="typ">MemoryUTXOSet</span><span class="pun">;
</span><span class="typ">KeyPair</span><span class="pun">[] </span><span class="pln">key_pairs </span><span class="pun">= [</span><span class="typ">KeyPair<wbr/></span><span class="pun">.</span><span class="pln">random</span><span class="pun">, </span><span class="typ">KeyPair<wbr/></span><span class="pun">.</span><span class="pln">random</span><span class="pun">, </span><span class="typ">KeyPair<wbr/></span><span class="pun">.</span><span class="pln">random</span><span class="pun">, </span><span class="typ">KeyPair<wbr/></span><span class="pun">.</span><span class="pln">random</span><span class="pun">];

</span><span class="kwd">scope </span><span class="pln">payload_checker </span><span class="pun">= </span><span class="kwd">new </span><span class="typ">FeeManager</span><span class="pun">();
</span><span class="kwd">scope </span><span class="pln">checker </span><span class="pun">= &amp;</span><span class="pln">payload_checker<wbr/></span><span class="pun">.</span><span class="pln">check</span><span class="pun">;

</span><span class="typ">Height </span><span class="pln">height</span><span class="pun">;

</span><span class="typ">Transaction </span><span class="pln">secondTx</span><span class="pun">;
</span><span class="typ">Transaction </span><span class="pln">thirdTx</span><span class="pun">;
</span><span class="typ">Transaction </span><span class="pln">fourthTx</span><span class="pun">;
</span><span class="typ">Transaction </span><span class="pln">fifthTx</span><span class="pun">;

</span><span class="typ">Hash </span><span class="pln">previousHash</span><span class="pun">;
</span><span class="typ">Hash </span><span class="pln">secondHash</span><span class="pun">;
</span><span class="typ">Hash </span><span class="pln">thirdHash</span><span class="pun">;
</span><span class="typ">Hash </span><span class="pln">fifthHash</span><span class="pun">;

</span><span class="com">// Create the previous transaction with type &lt;code class="lang-d"&gt;&lt;span class="typ"&gt;OutputType&lt;wbr/&gt;&lt;/span&gt;&lt;span class="pun"&gt;.&lt;/span&gt;&lt;span class="typ"&gt;Payment&lt;/span&gt;&lt;/code&gt;
// Expected height : 0
// Expected Status : melted
</span><span class="pun">{
    <a href="../../../../agora/consensus/validation/Transaction/is_invalid_reason.html#height"></span><span class="pln">height</span></a><span class="pln"> </span><span class="pun">= </span><span class="lit">0</span><span class="pun">;
    </span><span class="typ">Transaction </span><span class="pln">previousTx </span><span class="pun">= </span><span class="typ">Transaction</span><span class="pun">(
        [ </span><span class="typ">Output</span><span class="pun">(</span><span class="typ">Amount<wbr/></span><span class="pun">.</span><span class="typ">MinFreezeAmount </span><span class="pun">+ </span><span class="lit">10_000<wbr/></span><span class="pun">.</span><span class="pln">coins</span><span class="pun">, </span><span class="pln">key_pairs</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]<wbr/>.</span><span class="pln">address</span><span class="pun">) ]);

    </span><span class="com">// Save to UTXOSet
    </span><span class="pln">previousHash </span><span class="pun">= </span><span class="pln">hashFull</span><span class="pun">(</span><span class="pln">previousTx</span><span class="pun">);
    </span><span class="kwd">foreach </span><span class="pun">(</span><span class="pln">idx</span><span class="pun">, </span><span class="pln">output</span><span class="pun">; </span><span class="pln">previousTx<wbr/></span><span class="pun">.</span><span class="pln">outputs</span><span class="pun">)
    {
        </span><span class="kwd">const </span><span class="typ">Hash </span><span class="pln">utxo_hash </span><span class="pun">= </span><span class="pln">hashMulti</span><span class="pun">(</span><span class="pln">previousHash</span><span class="pun">, </span><span class="pln">idx</span><span class="pun">);
        </span><span class="kwd">const </span><span class="pln">UTXO utxo_value </span><span class="pun">= {</span></code></pre>
</section>
<section><h2>unlock height</h2>
<p>height+1,
</p>
</section>
<section><h2>output</h2>
<p>output
        };
        storage[utxo_hash] = utxo_value;
    }
}
</p>

<p>// Creates the second freezing transaction
// Current height  : 0
// Current Status  : melted
// Expected height : 1
// Expected Status : frozen
{
    height = 1;
    secondTx = Transaction(
        [Input(previousHash, 0)],
        [Output(Amount.MinFreezeAmount, key_pairs[1].address, OutputType.Freeze)]
    );
    secondTx.inputs[0].unlock = signUnlock(key_pairs[0], secondTx);
</p>

<p>    // Second Transaction is VALID.
    assert(secondTx.isValid(engine, storage.getUTXOFinder(), height, checker));
</p>

<p>    // Save to UTXOSet
    secondHash = hashFull(secondTx);
    foreach (idx, output; secondTx.outputs)
    {
        const Hash utxo_hash = hashMulti(secondHash, idx);
        const UTXO utxo_value = {
</p>
</section>
<section><h2>unlock height</h2>
<p>height+1,
</p>
</section>
<section><h2>output</h2>
<p>output
        };
        storage[utxo_hash] = utxo_value;
    }
}
</p>

<p>// Creates the third payment transaction
// Current height  : 1
// Current Status  : frozen
// Expected height : 2
// Expected Status : melting
{
    height = 2;
    thirdTx = Transaction([Input(secondHash, 0)],
        [Output(Amount.MinFreezeAmount, key_pairs[2].address)]
    );
    thirdTx.inputs[0].unlock = signUnlock(key_pairs[1], thirdTx);
</p>

<p>    // Third Transaction is VALID.
    assert(thirdTx.isValid(engine, storage.getUTXOFinder(), height, checker));
</p>

<p>    // Save to UTXOSet
    thirdHash = hashFull(thirdTx);
    foreach (idx, output; thirdTx.outputs)
    {
        const Hash utxo_hash = hashMulti(thirdHash, idx);
        const UTXO utxo_value = {
</p>
</section>
<section><h2>unlock height</h2>
<p>height+2016,
</p>
</section>
<section><h2>output</h2>
<p>output
        };
        storage[utxo_hash] = utxo_value;
    }
}
</p>

<p>// Creates the fourth payment transaction : didn't change to melted not yet
// Current height  : 2+2014
// Current Status  : melting
// Expected height : 2+2015
// Expected Status : melting
{
    height = 2+2015;  //  this is melting, not melted
    fourthTx = Transaction([Input(thirdHash, 0)],
        [Output(Amount.MinFreezeAmount, key_pairs[3].address)]
    );
    fourthTx.inputs[0].unlock = signUnlock(key_pairs[2], fourthTx);
</p>

<p>    // Third Transaction is INVALID.
    assert(!fourthTx.isValid(engine, storage.getUTXOFinder(), height, checker));
}
</p>

<p>// Creates the fifth payment transaction
// Current height  : 2+2015
// Current Status  : melting
// Expected height : 2+2016
// Expected Status : melted
{
    height = 2+2016;  //  this is melted
    fifthTx = Transaction(
            [Input(thirdHash, 0)],
        [Output(Amount.MinFreezeAmount, key_pairs[3].address)]
    );
    fifthTx.inputs[0].unlock = signUnlock(key_pairs[2], fourthTx);
</p>

<p>    // Third Transaction is VALID.
    assert(fifthTx.isValid(engine, storage.getUTXOFinder(), height, checker));
</p>

<p>    // Save to UTXOSet
    fifthHash = hashFull(fifthTx);
    foreach (idx, output; fifthTx.outputs)
    {
        const Hash utxo_hash = hashMulti(fifthHash, idx);
        const UTXO utxo_value = {
</p>
</section>
<section><h2>unlock height</h2>
<p>height+1,
</p>
</section>
<section><h2>output</h2>
<p>output
        };
        storage[utxo_hash] = utxo_value;
    }
}
</p>

<pre class="code"><code class="lang-d"><span class="pln">
</span><span class="typ">Example</span><span class="pun">:
</span><span class="pln">test </span><span class="kwd">for </span><span class="pln">transactions having no input or no output</span></code></pre>
<p>import std.string;
import std.algorithm.searching;
</p>

<p>scope engine = new Engine();
scope storage = new MemoryUTXOSet;
KeyPair key_pair = KeyPair.random;
</p>

<p>scope payload_checker = new FeeManager();
scope checker = &payload_checker.check;
</p>

<p>// create a transaction having no input
Transaction oneTx = Transaction(
    [],
    [Output(Amount(50), key_pair.address)]
);
storage.put(oneTx);
</p>

<p>// test for Payment transaction having no input
assert(canFind(toLower(oneTx.isInvalidReason(engine, storage.getUTXOFinder(), Height(0),
    checker, toDelegate(utGetPenaltyDeposit))), "no input"),
    format("Tx having no input should not pass validation. tx: %s", oneTx));
</p>

<p>// create a transaction
Transaction firstTx = Transaction([ Output(Amount(100_1000), key_pair.address) ]);
Hash firstHash = hashFull(firstTx);
storage.put(firstTx);
</p>

<p>// create a transaction having no output
Transaction secondTx = Transaction(
    [Input(firstHash, 0)],
    []
);
storage.put(secondTx);
</p>

<p>// test for Freeze transaction having no output
assert(canFind(toLower(secondTx.isInvalidReason(engine, storage.getUTXOFinder(), Height(0),
    checker, toDelegate(utGetPenaltyDeposit))), "no output"),
    format("Tx having no output should not pass validation. tx: %s", secondTx));
</p>

<pre class="code"><code class="lang-d"><span class="pln">
</span><span class="typ">Example</span><span class="pun">:
</span><span class="pln">test </span><span class="kwd">for </span><span class="pln">transaction having combined inputs</span></code></pre>
<p>scope engine = new Engine();
scope storage = new MemoryUTXOSet;
KeyPair[] key_pairs = [KeyPair.random, KeyPair.random];
</p>

<p>scope payload_checker = new FeeManager();
scope checker = &payload_checker.check;
</p>

<p>// create the first transaction.
Transaction firstTx = Transaction(
    [Input(Hash.init, 0)],
    [Output(Amount(100), key_pairs[0].address)]
);
Hash firstHash = hashFull(firstTx);
storage.put(firstTx);
</p>

<p>// create the second transaction.
Transaction secondTx = Transaction(
    [Input(Hash.init, 0)],
    [Output(Amount(100), key_pairs[0].address, OutputType.Freeze)]
);
Hash secondHash = hashFull(secondTx);
storage.put(secondTx);
</p>

<p>// create the third transaction
Transaction thirdTx = Transaction(
    [Input(firstHash, 0), Input(secondHash, 0)],
    [Output(Amount(100), key_pairs[1].address)]
);
Hash thirdHash = hashFull(thirdTx);
storage.put(thirdTx);
thirdTx.inputs[0].unlock = signUnlock(key_pairs[0], thirdTx);
thirdTx.inputs[1].unlock = signUnlock(key_pairs[0], thirdTx);
</p>

<p>// test for transaction having combined inputs
assert(!thirdTx.isValid(engine, storage.getUTXOFinder(), Height(0), checker),
    format("Tx having combined inputs should not pass validation. tx: %s", thirdTx));
</p>

<pre class="code"><code class="lang-d"><span class="pln">
</span><span class="typ">Example</span><span class="pun">:
</span><span class="pln">test </span><span class="kwd">for </span><span class="pln">unknown transaction output type</span></code></pre>
<p>scope engine = new Engine();
Transaction[Hash] storage;
OutputType unknown_type = cast(OutputType)100; // picking value beyond enum range
KeyPair key_pair = KeyPair.random;
</p>

<p>scope payload_checker = new FeeManager();
scope checker = &payload_checker.check;
</p>

<p>// create a transaction having unknown transaction type
Transaction firstTx = Transaction([Input(Hash.init, 0)],
    [Output(Amount(100), key_pair.address, unknown_type)]
);
Hash firstHash = hashFull(firstTx);
storage[firstHash] = firstTx;
</p>

<p>// test for unknown transaction type
assert(!firstTx.isValid(engine, null, Height(0), checker),
    format("Tx having unknown type should not pass validation. tx: %s", firstTx));
</p>

<pre class="code"><code class="lang-d"><span class="pln">
</span><span class="typ">Example</span><span class="pun">:
</span><span class="pln">test </span><span class="kwd">for </span><span class="pln">checking input overflow </span><span class="kwd">for </span><span class="typ">Payment </span><span class="pln">and </span><span class="typ">Freeze </span><span class="pln">type transactions</span></code></pre>
<p>scope engine = new Engine();
scope storage = new MemoryUTXOSet();
KeyPair[] key_pairs = [KeyPair.random, KeyPair.random];
</p>

<p>scope payload_checker = new FeeManager();
scope checker = &payload_checker.check;
</p>

<p>// create the first transaction
auto firstTx = Transaction(
    [Input(Hash.init, 0)],
    [Output(Amount.MaxUnitSupply, key_pairs[0].address)]
);
storage.put(firstTx);
const firstHash = UTXO.getHash(firstTx.hashFull(), 0);
</p>

<p>// create the second transaction
auto secondTx = Transaction(
    [Input(Hash.init, 0)],
    [Output(Amount(100), key_pairs[0].address)]
);
storage.put(secondTx);
const secondHash = UTXO.getHash(secondTx.hashFull(), 0);
</p>

<p>// create the third transaction
auto thirdTx = Transaction(
    [Input(firstHash, 0), Input(secondHash, 0)],
    [Output(Amount(100), key_pairs[1].address)]
);
storage.put(thirdTx);
auto thirdHash = hashFull(thirdTx);
thirdTx.inputs[0].unlock = signUnlock(key_pairs[0], thirdTx);
thirdTx.inputs[1].unlock = signUnlock(key_pairs[0], thirdTx);
</p>

<p>// test for input overflow in Payment transaction
assert(!thirdTx.isValid(engine, &storage.peekUTXO, Height(0), checker),
    format("Tx having input overflow should not pass validation. tx: %s", thirdTx));
</p>

<p>// create the fourth transaction
auto fourthTx = Transaction(
    [Input(firstHash, 0), Input(secondHash, 0)],
    [Output(Amount(100), key_pairs[1].address, OutputType.Freeze)]
);
storage.put(fourthTx);
auto fourthHash = hashFull(fourthTx);
fourthTx.inputs[0].unlock = signUnlock(key_pairs[0], fourthTx);
fourthTx.inputs[1].unlock = signUnlock(key_pairs[0], fourthTx);
</p>

<p>// test for input overflow in Freeze transaction
assert(!fourthTx.isValid(engine, &storage.peekUTXO, Height(0), checker),
    format("Tx having input overflow should not pass validation. tx: %s", fourthTx));
</p>

<pre class="code"><code class="lang-d"><span class="pln">
</span><span class="typ">Example</span><span class="pun">:
</span><span class="pln">test </span><span class="kwd">for </span><span class="pln">checking output overflow </span><span class="kwd">for </span><span class="typ">Payment </span><span class="pln">type transaction</span></code></pre>
<p>scope engine = new Engine();
scope storage = new MemoryUTXOSet();
KeyPair[] key_pairs = [KeyPair.random, KeyPair.random];
</p>

<p>scope payload_checker = new FeeManager();
scope checker = &payload_checker.check;
</p>

<p>// create the first transaction
auto firstTx = Transaction(
    [Input(Hash.init, 0)],
    [Output(Amount(100), key_pairs[0].address)]
);
storage.put(firstTx);
const firstHash = UTXO.getHash(firstTx.hashFull(), 0);
</p>

<p>// create the second transaction
auto secondTx = Transaction(
    [Input(Hash.init, 0)],
    [Output(Amount(100), key_pairs[0].address)]
);
storage.put(secondTx);
const secondHash = UTXO.getHash(secondTx.hashFull(), 0);
</p>

<p>// create the third transaction
auto thirdTx = Transaction(
    [Input(firstHash, 0), Input(secondHash, 0)],
    [Output(Amount.MaxUnitSupply, key_pairs[1].address),
        Output(Amount(100), key_pairs[1].address)]
);
storage.put(thirdTx);
auto thirdHash = hashFull(thirdTx);
thirdTx.inputs[0].unlock = signUnlock(key_pairs[0], thirdTx);
thirdTx.inputs[1].unlock = signUnlock(key_pairs[0], thirdTx);
</p>

<p>// test for output overflow in Payment transaction
assert(!thirdTx.isValid(engine, &storage.peekUTXO, Height(0), checker),
    format("Tx having output overflow should not pass validation. tx: %s", thirdTx));
</p>

<pre class="code"><code class="lang-d"><span class="pln">
</span><span class="typ">Example</span><span class="pun">:
</span><span class="pln">test </span><span class="kwd">for </span><span class="pln">transaction to store data</span></code></pre>
<p>scope engine = new Engine();
scope storage = new MemoryUTXOSet;
KeyPair key_pair = KeyPair.random;
</p>

<p>scope payload_checker = new FeeManager();
scope checker = &payload_checker.check;
</p>

<p>// create the payment transaction.
Transaction paymentTx = Transaction(
    [Input(Hash.init)],
    [Output(80_000.coins, key_pair.address)]
);
storage.put(paymentTx);
Hash payment_utxo = UTXO.getHash(paymentTx.hashFull(), 0);
</p>

<p>// create the frozen transaction.
Transaction frozenTx = Transaction(
    [Input(Hash.init)],
    [Output(80_000.coins, key_pair.address, OutputType.Freeze)]
);
storage.put(frozenTx);
Hash frozen_utxo = UTXO.getHash(frozenTx.hashFull(), 0);
</p>

<p>// create data with nomal size
ubyte[] normal_data;
normal_data.length = payload_checker.params.TxPayloadMaxSize;
foreach (idx; 0 .. normal_data.length)
    normal_data[idx] = cast(ubyte)(idx % 256);
</p>

<p>// create data with large size
ubyte[] large_data;
large_data ~= normal_data;
large_data ~= cast(ubyte)(0);
</p>

<p>// calculate fee
Amount normal_data_fee = calculateDataFee(normal_data.length,
    payload_checker.params.TxPayloadFeeFactor);
Amount large_data_fee = calculateDataFee(large_data.length,
    payload_checker.params.TxPayloadFeeFactor);
</p>

<p>Transaction dataTx;
Hash dataHash;
</p>


<p>// Test 1. Too large data
// create a transaction with large data
dataTx = Transaction(
    [Input(payment_utxo)],
    [
        Output(large_data_fee, payload_checker.params.CommonsBudgetAddress),
        Output(40_000.coins, key_pair.address)
    ].sort.array,
    large_data,
);
dataHash = hashFull(dataTx);
dataTx.inputs[0].unlock = signUnlock(key_pair, dataTx);
</p>

<p>// test for the transaction with large data
assert(!dataTx.isValid(engine, &storage.peekUTXO, Height(0), checker),
    format("When storing data, tx with large data payload should not pass validation. tx: %s", dataTx));
</p>


<p>// Test 2. With not enough fee
// create a transaction with not enough fee
dataTx = Transaction(
    [Input(payment_utxo)],
    [Output(Amount(80_000L * 10_000_000L - normal_data_fee.integral + 1),
        key_pair.address)],
    normal_data,
);
dataHash = hashFull(dataTx);
dataTx.inputs[0].unlock = signUnlock(key_pair, dataTx);
</p>

<p>// test for transaction without commons budget
assert(!dataTx.isValid(engine, &storage.peekUTXO, Height(0), checker),
    format("When storing data, tx with not enough fee should not pass validation. tx: %s", dataTx));
</p>

<p>// Test 3. Nomal
// create a transaction with enough fee
Amount rem_amount = paymentTx.outputs[0].value;
rem_amount.sub(normal_data_fee);
dataTx = Transaction(
    [Input(payment_utxo)],
    [Output(rem_amount, key_pair.address)],
    normal_data,
);
dataHash = hashFull(dataTx);
dataTx.inputs[0].unlock = signUnlock(key_pair, dataTx);
</p>

<p>// test for the transaction with enough fee
assert(dataTx.isValid(engine, &storage.peekUTXO, Height(0), checker),
    format("When storing data, Transaction data is not validated. tx: %s", dataTx));
</p>


<p>// Test 5. Using frozen input
// create the data transaction.
dataTx = Transaction(
    [Input(frozen_utxo)],
    [
        Output(40_000.coins, key_pair.address)
    ],
    normal_data,
);
dataHash = hashFull(dataTx);
dataTx.inputs[0].unlock = signUnlock(key_pair, dataTx);
</p>

<p>// test for data storage using frozen input
assert(dataTx.isValid(engine, &storage.peekUTXO, Height(0), checker),
    format("When storing data, tx with frozen input should pass validation. tx: %s", dataTx));
</p>


<p>// Test 6. The transaction with the type of Freeze
// create the data transaction.
dataTx = Transaction(
    [Input(payment_utxo)],
    [
        Output(40_000.coins, key_pair.address, OutputType.Freeze)
    ],
    normal_data,
);
dataHash = hashFull(dataTx);
dataTx.inputs[0].unlock = signUnlock(key_pair, dataTx);
</p>

<p>// test for data storage using frozen input
assert(!dataTx.isValid(engine, &storage.peekUTXO, Height(0), checker),
    format("When storing data, tx with type of Freeze should not pass validation. tx: %s", dataTx));
</p>

<pre class="code"><code class="lang-d"><span class="pln">
</span><span class="typ">Example</span><span class="pun">:
</span><span class="pln">transaction</span><span class="pun">-</span><span class="pln">level absolute time lock</span></code></pre>
<p>scope engine = new Engine();
scope storage = new MemoryUTXOSet;
scope payload_checker = new FeeManager();
scope checker = &payload_checker.check;
</p>

<p>KeyPair kp = KeyPair.random();
</p>

<p>Transaction prev_tx = Transaction([Output(Amount(100), kp.address)]);
storage.put(prev_tx);
</p>

<p>Transaction tx = Transaction(
    [Input(hashFull(prev_tx), 0)],
    [Output(Amount(50), kp.address)]);
</p>

<p>// effectively disabled lock
tx.lock_height = Height(0);
tx.inputs[0].unlock = signUnlock(kp, tx);
assert(tx.isInvalidReason(engine, storage.getUTXOFinder(), Height(0),
    checker, toDelegate(utGetPenaltyDeposit)) is null);
assert(tx.isInvalidReason(engine, storage.getUTXOFinder(), Height(1024),
    checker, toDelegate(utGetPenaltyDeposit)) is null);
</p>

<p>tx.lock_height = Height(10);
tx.inputs[0].unlock = signUnlock(kp, tx);
assert(tx.isInvalidReason(engine, storage.getUTXOFinder(), Height(0),
    checker, toDelegate(utGetPenaltyDeposit)) == "Transaction: Not unlocked for this height");
assert(tx.isInvalidReason(engine, storage.getUTXOFinder(), Height(9),
    checker, toDelegate(utGetPenaltyDeposit)) == "Transaction: Not unlocked for this height");
assert(tx.isInvalidReason(engine, storage.getUTXOFinder(), Height(10),
    checker, toDelegate(utGetPenaltyDeposit)) == null);
assert(tx.isInvalidReason(engine, storage.getUTXOFinder(), Height(1024),
    checker, toDelegate(utGetPenaltyDeposit)) == null);
</p>

<pre class="code"><code class="lang-d"></code></pre>
</section>

			<footer>
				<table class="license-info">
					<tr>
						<th>Authors</th>
						<td>
							
						</td>
					</tr>
					<tr>
						<th>Copyright</th>
						<td>
							<p>Copyright (c) 2019-2021 BOSAGORA Foundation
        All rights reserved.
</p>

						</td>
					</tr>
					<tr>
						<th>License</th>
						<td>
							<p>MIT License. See LICENSE for details.
</p>

						</td>
					</tr>
				</table>
				<p class="faint">Generated using the DDOX documentation generator</p>
			</footer>
		</div>
	</body>
</html>