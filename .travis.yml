language: d

# Trusty is Travis' default but reached EOL 2019-04-30
dist: xenial

# I gave up trying to install libsodium
sudo: required

env:
  - SODIUM_VERSION=1.0.17

# No way to install the apt package, so...
before_install:
  - pushd $HOME
  - wget https://github.com/jedisct1/libsodium/releases/download/${SODIUM_VERSION}/libsodium-${SODIUM_VERSION}.tar.gz
  - tar xvfz libsodium-${SODIUM_VERSION}.tar.gz
  - cd libsodium-${SODIUM_VERSION}
  - ./configure
  - make -j4
  - sudo make install
  - sudo ldconfig # Refresh cache
  - popd

script:
  - dub test --compiler=${DC}

# Latest version of DMD/GDC/LDC
d:
  - dmd
#  - gdc # Too old, doesn't support bitblob
  - ldc
